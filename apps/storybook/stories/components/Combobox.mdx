import { Meta, Canvas, ArgTypes } from "@storybook/addon-docs/blocks";
import * as ComboboxStories from "./Combobox.stories.svelte";
import { Combobox } from "$saas/components/combobox";
import {
	comboboxPattern,
	comboboxRootPattern,
	comboboxControlPattern,
	comboboxInputPattern,
	comboboxContentPattern,
	comboboxItemPattern,
	comboboxItemTextPattern,
	comboboxItemIndicatorPattern,
} from "../utils";

<Meta of={ComboboxStories} />

# Combobox

## A versatile input component that combines a text input with a listbox, allowing users to filter a list of options and select single or multiple values.

[Ark UI](https://ark-ui.com/docs/components/combobox)

<Canvas of={ComboboxStories.Basic} />

## Usage

The simplest way to use the Combobox is with the all-in-one `Combobox` component:

```tsx
<script>
	import { Combobox } from "$saas/components/combobox";

	const frameworks = [
		{ label: "React", value: "react" },
		{ label: "Vue", value: "vue" },
		{ label: "Svelte", value: "svelte" },
	];
</script>

<Combobox
	items={frameworks}
	label="Select framework"
	placeholder="Type to search"
/>
```

The `Combobox` component handles filtering and collection management internally, making it easy to get started.

## Examples

### Sizes

Use the `size` prop to change the size of the combobox.

<Canvas of={ComboboxStories.Sizes} />

### Variants

Use the `variant` prop to change the appearance of the input.

<Canvas of={ComboboxStories.Variants} />

### Multiple Selection

Use the `multiple` prop to allow selecting multiple values. When enabled, the combobox clears the input after each selection.

<Canvas of={ComboboxStories.Multiple} />

### Async Loading

Use the `loading`, `loadingText`, and `onInputValueChange` props to load items asynchronously as users type.

<Canvas of={ComboboxStories.AsyncLoading} />

### Highlight Matching Text

Use the `highlightMatch` prop to highlight the matching text in search results with a yellow background.

<Canvas of={ComboboxStories.HighlightMatch} />

### Open on Click

Use the `openOnClick` prop to open the combobox when the user clicks on the input.

<Canvas of={ComboboxStories.OpenOnClick} />

### Custom Objects

Use the `itemPrefixKey` prop to show a prefix (like a flag emoji) before item labels.

<Canvas of={ComboboxStories.CustomObjects} />

### Minimum Characters

Use the `minCharacters` prop to require a minimum number of characters before showing the dropdown.

<Canvas of={ComboboxStories.MinCharacters} />

### Field

Use the `Field` component to add labels, helper text, and error messages.

<Canvas of={ComboboxStories.Field} />

### Disabled

Use the `disabled` prop to disable the combobox.

<Canvas of={ComboboxStories.Disabled} />

### Disabled Item

Use the `isItemDisabled` prop to disable specific items in the list.

<Canvas of={ComboboxStories.DisabledItem} />

### Input Group

Use the `startElement` snippet prop to add an icon or other element at the start of the input.

<Canvas of={ComboboxStories.InputGroup} />

### Invalid

Use the `invalid` prop to show the error state.

<Canvas of={ComboboxStories.Invalid} />

### Controlled Value

Use the `value` and `onValueChange` props to control the combobox's value programmatically.

<Canvas of={ComboboxStories.ControlledValue} />

### Controlled Open

Use the `open` and `onOpenChange` props to control the combobox's open state programmatically.

<Canvas of={ComboboxStories.ControlledOpen} />

### Allow Custom Value

Use the `allowCustomValue` prop to allow users to enter values that aren't in the list.

<Canvas of={ComboboxStories.AllowCustomValue} />

### Limit Results

Use the `limit` prop to limit the number of items displayed in the dropdown.

<Canvas of={ComboboxStories.Limit} />

### Virtualisation

Use the `virtualised` prop to enable virtual scrolling for large lists. This significantly improves performance when rendering hundreds or thousands of items by only rendering the visible items in the viewport.

<Canvas of={ComboboxStories.Virtualised} />

### Links

Items with an `href` property can be used for navigation.

<Canvas of={ComboboxStories.Links} />

### Colours

Use the `colour` prop to change the colour palette of the combobox.

<Canvas of={ComboboxStories.Colours} />

### Custom Filter

Use the `disableFilter` prop combined with `onInputValueChange` to implement custom filtering logic. This is useful when you need to search across multiple fields.

<Canvas of={ComboboxStories.CustomFilter} />

### In Popover

Use the Combobox inside a Popover for dropdown-style selection triggered by a button.

<Canvas of={ComboboxStories.InPopover} />

## Advanced Usage

For more control over the combobox structure and behavior, use `ComboboxRoot` with granular components and `createListCollection`:

```tsx
<script>
	import { Combobox, createListCollection } from "$saas/components/combobox";

	const items = [
		{ label: "React", value: "react" },
		{ label: "Vue", value: "vue" },
		{ label: "Svelte", value: "svelte" },
	];

	let inputValue = $state("");
	const filteredItems = $derived(items.filter((item) => item.label.toLowerCase().includes(inputValue.toLowerCase())));
	const collection = $derived(createListCollection({ items: filteredItems }));
</script>

<Combobox.Root {collection} onInputValueChange={(e) => (inputValue = e.inputValue)}>
	<Combobox.Control>
		<Combobox.Input placeholder="Search..." />
	</Combobox.Control>
	<Combobox.Content>
		{#each collection.items as item}
			<Combobox.Item {item}>
				<Combobox.ItemText>{item.label}</Combobox.ItemText>
			</Combobox.Item>
		{/each}
	</Combobox.Content>
</Combobox.Root>
```

## Props

### Combobox

<ArgTypes of={Combobox} exclude={comboboxPattern} />

### Combobox.Root

<ArgTypes of={Combobox.Root} exclude={comboboxRootPattern} />

### Combobox.Control

<ArgTypes of={Combobox.Control} exclude={comboboxControlPattern} />

### Combobox.Input

<ArgTypes of={Combobox.Input} exclude={comboboxInputPattern} />

### Combobox.Content

<ArgTypes of={Combobox.Content} exclude={comboboxContentPattern} />

### Combobox.Item

<ArgTypes of={Combobox.Item} exclude={comboboxItemPattern} />

### Combobox.ItemText

<ArgTypes of={Combobox.ItemText} exclude={comboboxItemTextPattern} />

### Combobox.ItemIndicator

<ArgTypes of={Combobox.ItemIndicator} exclude={comboboxItemIndicatorPattern} />
